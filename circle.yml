machine:
  timezone:
    America/Los_Angeles

  ruby:
    version:
      '2.1.1'

  node:
    version: '5.1.0'

dependencies:
  pre:
    - npm install -g npm@5.1.0
  cache_directories:
    - ~/elasticsearch-1.7.6
  post:
    - wget https://download.elastic.co/elasticsearch/elasticsearch/elasticsearch-1.7.6.tar.gz
    - tar -xvf elasticsearch-1.7.6.tar.gz
    - elasticsearch-1.7.6/bin/elasticsearch: {background: true}
    # Make sure that Elasticsearch is up before running tests:
    - sleep 10 && wget --waitretry=5 --retry-connrefused -v http://127.0.0.1:9200/

database:
  override:
    - cp config/templates/database.yml.ci config/database.yml
    - cp config/templates/secrets.yml.ci config/secrets.yml
    - bundle exec rake db:create db:schema:load
    - npm install --only=dev