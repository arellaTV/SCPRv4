<script>
  dataLayer = [{
    'storyId': '<%= @story.try(:id) %>',
    'storyShortHeadline': '<%= @story.try(:short_headline) %>',
    'storyByline': '<%= @story.try(:byline) %>',
    'storyCategory': '<%= @story.try(:category).try(:title) %>',
    'segmentId': '<%= @segment.try(:id) %>',
    'segmentShortHeadline': '<%= @segment.try(:short_headline) %>',
    'segmentByline': '<%= @segment.try(:byline) %>',
    'segmentProgram': '<%= @program.try(:title) %>'
  }];
</script>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-585PL29');</script>


<!-- Meta tags which are the same across all pages -->
<meta charset="utf-8">
<meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="format-detection" content="telephone=no" />
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta property="fb:app_id" content="129848480405753" />
<meta property="fb:pages" content="21819923015">
<link rel="publisher" href="https://plus.google.com/108872361044769229886/" />

<%= tag "meta", name: "keywords", content: meta_information[:keywords] || "KPCC, California, Southern California, Los Angeles, Pasadena, SCPR, Southern California Public Radio" %>
<meta name="author" content="Southern California Public Radio" />
<% if Rails.env.staging? %>
  <meta name="robots" content="noindex">
<% end %>

<meta property="og:site_name" content="Southern California Public Radio" />
<%= tag "meta", name: "twitter:domain", content: meta_information[:url] || "https://scpr.org" %>
<meta name="twitter:site" content="@kpcc"/>
<% if content_for? :opengraph %>
  <%= yield :opengraph %>
<% else %>
  <meta name="twitter:card" content="summary"/>
  <%= tag "meta", name: "twitter:url", content: meta_information[:url] || "https://scpr.org" %>
  <%= tag "meta", name: "twitter:title", content: h(meta_information[:title] || page_title) %>
  <%= tag "meta", name: "twitter:description", content: "Member-supported public radio for Southern California. Award-winning local news and cultural programming alongside the best of NPR." %>
  <meta property="og:image" content="<%=image_url('meta/facebook.jpg')%>" />
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="<%=image_url('meta/twitter.jpg')%>">
<% end %>

<%= csrf_meta_tags %>

<%= tag "link", rel: "alternate", type: "application/rss+xml", title: "RSS", href: meta_information[:rss_feed] || "https://scpr.org/feeds/all_news" %>
<%= amp_head_link %>

<%= favicon_link_tag '/favicon.ico' %>

<script>
  window.fbAsyncInit = function() {
	FB.init({
	  appId            : '129848480405753',
	  autoLogAppEvents : true,
	  xfbml            : true,
	  version          : 'v2.10'
	});
	FB.AppEvents.logPageView();
  };

  (function(d, s, id){
	 var js, fjs = d.getElementsByTagName(s)[0];
	 if (d.getElementById(id)) {return;}
	 js = d.createElement(s); js.id = id;
	 js.src = "//connect.facebook.net/en_US/sdk.js";
	 fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
